asyncapi: 3.0.0
info:
  title: Payment Service AsyncAPI for Kafka
  version: 1.0.0
servers:
  development:
    host: 'localhost:29929'
    protocol: kafka
    description: This is the kafka broker.
channels:
  order:
    address: order
    messages:
      OrderReceived:
        $ref: '#/components/messages/OrderReceived'
        examples: null
  payment:
    address: payment
    messages:
      PaymentCreated:
        $ref: '#/components/messages/PaymentCreated'
      PaymentUpdated:
        $ref: '#/components/messages/PaymentUpdated'
operations:
  OrderReceived:
    action: receive
    channel:
      $ref: '#/channels/order'
    messages:
      - $ref: '#/channels/order/messages/OrderReceived'
  PaymentCreated:
    action: send
    channel:
      $ref: '#/channels/payment'
    messages:
      - $ref: '#/channels/payment/messages/PaymentCreated'
  PaymentUpdated:
    action: send
    channel:
      $ref: '#/channels/payment'
    messages:
      - $ref: '#/channels/payment/messages/PaymentUpdated'
components:
  messages:
    OrderReceived:
      headers:
        type: object
        properties:
          source:
            type: string
            const: "order"
          timestamp:
            type: integer
            format: unix
          operation:
            type: string
      payload:
        type: object
        $ref: "../common/schemas.yaml#/components/schemas/Order"
    
    PaymentCreated:
      summary: Payment created
      headers:
        type: object
        properties:
          source:
            type: string
            const: "payment"
          timestamp:
            type: integer
            format: unix
          operation:
            type: string
            const: "created"
      payload:
        type: object
        $ref: "../common/schemas.yaml#/components/schemas/Payment"
    PaymentUpdated:
      summary: Payment Updated
      headers:
        type: object
        properties:
          source:
            type: string
            const: "payment"
          timestamp:
            type: integer
            format: unix
          operation:
            type: string
            const: "updated"
      payload:
        type: object
        $ref: "../common/schemas.yaml#/components/schemas/Payment"
